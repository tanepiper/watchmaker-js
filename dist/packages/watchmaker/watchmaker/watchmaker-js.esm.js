"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("Storage");function e(t,e,n){e=e||20,n=n||{splitChar:" ",joinChar:" "},console.log(t);for(var r=(t||"").split(n.splitChar),o=[],a="",i=0;i<r.length;i++){var s=r[i],u=r[i+1],c=[a=[a,s].join(" ").trim(),u].join(" ");u&&c.length>e&&(o.push(""+a),a="")}return a&&o.push(a),o}function n(t,n,r,o){n=n||4;for(var a=[],i=e(t,r=r||18),s=!1;!s;){var u=i.splice(0,n);0===u.length?s=!0:a.push(u.join("\n"))}return a}var r=require("locale");exports.convertStringToPage=n,exports.createAlert=function(t,e,r){r||(t=n(t)[0]),E.showAlert(t).then(e)},exports.createCountUp=function(t,e,n){var r,o,a=t/(n=n||1);return{start:new Promise((function(t){o=t;var i=1;r=setInterval((function(){if(i===a)return o(!1),clearInterval(r);e(i*n),i++}),1e3*n),e(0)})),cancel:function(){clearInterval(r),o(!0)}}},exports.createCountdown=function(t,e,n){var r,o,a=t/(n=n||1);return{start:new Promise((function(i){o=i;var s=1;r=setInterval((function(){if(s===a)return o(!1),clearInterval(r);e(t-s*n),s++}),1e3*n),e(t)})),cancel:function(){clearInterval(r),o(!0)}}},exports.createMenu=function(t,e,n,r,o){E.showMenu();var a={"":{title:t}};return e&&(a[" "]={value:e}),Object.keys(n).forEach((function(t){a[t]=n[t]})),r&&(a["< Back"]=r),o&&(a["<< Exit"]=o),E.showMenu(a)},exports.createMessage=function(t,e,r,o){return r=r||0,o||(e=n(e)[0]),new Promise((function(n){E.showMessage(e,t),setTimeout((function(){return n()}),r)}))},exports.createScrollPrompt=function(t,n,o,a){o||(o={Yes:!0,No:!1}),a=a||0;var i=Object.keys(o),s=e(n);function u(e){g.clear(1),g.reset().setFont("6x8",2).setFontAlign(0,0);var n=g.getWidth(),o=g.getHeight();if(t){t=r.translate(t),g.drawString(t,n/2,34);var a=(g.stringWidth(t)+16)/2;g.fillRect(n/2-a,44,n/2+a,44)}var u=(o-16*s.length)/2;s.forEach((function(t,e){return g.drawString(r.translate(t),n/2,u+16*e)}));var c,l=r.translate(i[e]);c=16+g.stringWidth(l);var f=(n-c)/2,h=o-40,p=g.stringWidth(l),v=2+p/2,d=[(f+=(p+16)/2)-v,h-12,f+v,h-12,f+v+4,h-8,f+v+4,h+8,f+v,h+12,f-v,h+12,f-v-4,h+8,f-v-4,h-8,f-v,h-12];g.setColor(759).fillPoly(d).setColor(-1).drawPoly(d).drawString(l,f,h+1),g.setColor(e?-1:0),g.fillPoly([120,h-29,106,h-15,134,h-15]),g.setColor(i.length-1===e?0:-1),g.fillPoly([120,h+12+4+14,106,h+12+4,134,h+12+4]),g.setColor(-1).flip()}return Bangle.btnWatches&&(Bangle.btnWatches.forEach(clearWatch),Bangle.btnWatches=void 0),g.clear(1),Bangle.drawWidgets(),u(a),new Promise((function(t){Bangle.btnWatches=[setWatch((function(){a>0&&u(--a)}),BTN1,{repeat:1}),setWatch((function(){a<i.length-1&&u(++a)}),BTN3,{repeat:1}),setWatch((function(){g.clear(1),t(o[i[a]])}),BTN2,{repeat:1})]}))},exports.createSelectPage=function(t,e,r,o,a){return o=o||0,a||(e=n(e)[0]),E.showPrompt(e,{title:t,buttons:r,selected:o})},exports.formatTimestampToDate=function(t){var e=new Date(t);return[""+e.getFullYear(),""+e.getMonth(),""+e.getDate()].map((function(t){return t.length<2?"0"+t:""+t})).join("-")},exports.formatTimestampToTime=function(t,e){var n=new Date(t),r=[""+n.getHours(),""+n.getMinutes(),""+n.getSeconds()].map((function(t){return t.length<2?"0"+t:""+t})).join(":");return e?r:r.substr(0,5)},exports.getFixedStringLines=e,exports.lug=function(e,n){var r=t.open(e+".data.json","a"),o={name:e,state:{},routes:n.routes||{home:{view:function(){return E.showAlert("No Lug Home Set")}}},currentRoute:"",getText:function(e){var n=t.readJSON(o.name+".text.json",1);return e?e.includes(".")?e.split(".").reduce((function(t,e){return t[e]&&t[e]||t}),n||{}):n[e]:n},getSettings:function(e){var n=t.readJSON(o.name+".settings.json",1);return n&&n[e]?n[e]:n},saveSettings:function(e){return t.writeJSON(o.name+".settings.json",e)},saveData:function(t){var e=JSON.stringify(t);r.write(e+"\n")},getData:function(e){var n=t.open(o.name+".data.json","r"),r=[];if(e)for(var a=0;a<e;a++){if(!(i=n.readLine()))break;r.push(JSON.parse(i))}else for(var i=n.readLine();void 0!==i;)r.push(JSON.parse(i)),i=n.readLine();return r},setState:function(t,e){o.state[t]=e},getState:function(t){return o.state[t]},goTo:function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];n.onChange&&n.onChange(o),o.routes[t]?(o.routes[t].view.apply(o,e),o.currentRoute=t):E.showAlert("Route "+t+" not found").then((function(){return o.routes.home.view.apply(o,e)}))}};return n.init(o),n.first&&setTimeout((function(){return n.first(o)}),1e3),o};
